#summary How to use this project
#labels Phase-Implementation

==Router==

==Locator==

The first thing you should attempt is to retrieve a list of hops from the Locator.  You create a new instance of the Locator by passing in a list of preferred transports, in order of preference.  Here, we are stating that we prefer TCP to UDP.  We then attempt to find the next hops for `sip:bob@biloxi.com`:

{{{
SipFactory factory = SipFactory.getInstance();
AddressFactory addressFactory = factory.createAddressFactory();
SipURI uri = addressFactory.createSipURI("bob", "biloxi.com");

List<String> transports = new LinkedList<String>();
transports.add(ListeningPoint.TCP);
transports.add(ListeningPoint.UDP);

Locator locator = new Locator(transports);
Queue<Hop> hops = locator.locate(uri);
}}}

When attempting to send a request you should poll the queue for the most appropriate hop.  The hop should be used to create a new route header like so:

{{{
HeaderFactory headerFactory = factory.createHeaderFactory();

SipURI routeUri = addressFactory.createSipURI(null, hop.getHost());
routeUri.setLrParam();
routeUri.setPort(hop.getPort());
if (hop.getTransport().equals("TLS")) {
    routeUri.setSecure(true);
    routeUri.setTransportParam("tcp");
} else if (hop.getTransport().equals("SCTP-TLS")) {
    routeUri.setSecure(true);
    routeUri.setTransportParam("sctp");
} else {
    routeUri.setTransportParam(hop.getTransport().toLowerCase());
}
Address routeAddress = addressFactory.createAddress(routeUri);
RouteHeader route = createRouteHeader(routeAddress);
}}}

You should then clone the request, add the route header to the top of route set, and send it.

{{{
Request clonedRequest = (Request) request.clone();
clonedRequest.addFirst(route);
ClientTransaction tx = sipProvider.getNewClientTransaction(clonedRequest);
tx.send();
}}}

If the transaction fails, poll the next hop from the queue and try again.  When the queue is empty, no more hops could be determined, and message sending has failed.  Depending on the type of failure, you may choose to try some or all of the hops again.